{% extends "base.twig" %}

{% block content %}

    <form action="{{baseurl}}/table/{{table.get_name}}" method="get" class="filters">
        <table>

            {% for fid,filter in filters %}
                <tr class="filter">
                    <td class="label">
                        <label>
                            {% if fid==0 %}Find records where{% else %}&hellip;and{% endif %}
                        </label>
                    </td>
                    <td>
                        <select name="filter[{{fid}}][column]">
                            {% for column in table.get_columns %}
                                <option value="{{column.get_name}}" {% if column.get_name==filter.column %}selected{% endif %}>
                                    {{column.get_title}}
                                </option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="filter[{{fid}}][operator]">
                            {% for op,name in operators %}
                                <option value="{{op}}" {% if op==filter.operator %}selected{% endif %}>
                                    {{name}}
                                </option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        {% if filter.operator == 'in' or filter.operator == 'not in' %}
                            <textarea name="filter[{{fid}}][value]">{{filter.value}}</textarea>
                        {% else %}
                            <input type="text" name="filter[{{fid}}][value]" value="{{filter.value}}" />
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}

            <tr>
                <td colspan="3">
                </td>
                <td class="buttons">
                    <button type="submit">Search</button>
                    {% if filter_count > 1 %}
                        <a href="{{baseurl}}/table/{{table.get_name}}" class="button">Clear filters</a>
                    {% endif %}
                </td>
            </tr>

        </table>
    </form>

    {% if records %}
        <div class='tablenav tablenav-top'>

            <!-- Right side -->
            <div class="alignleft actions bulkactions">
                Export to:
                <a href="{{baseurl}}/table/{{table.get_name()}}.csv" class="button"  title="Export to Comma Separated Values format">
                    CSV
                </a>
                {% if table.get_columns('point') %}
                    <a href="{{table.get_url('osm', {}, 'map')}}" class="button" title="Export to OpenStreetMap's XML format">
                        OSM
                    </a>
                    <a href="{{table.get_url('kml', {}, 'map')}}" class="button" title="Export to KML">
                        KML
                    </a>
                {% endif %}
            </div>

            <!-- Left side -->
            <div class='tablenav-pages'>
                <span class="displaying-num">
                    {{record_count|number_format}} record{% if record_count != 1 %}s{% endif %}
                </span>

                {% if table.get_page_count > 1 %}
                    <span class='pagination-links'>
                        <a class='first-page {%if table.get_current_page_num == 1%}disabled{% endif %}' title='Go to the first page'
                           href='{{ table.get_url( 'index', {"p":1} ) }}'>
                            &laquo;
                        </a>
                        <a class='prev-page {%if table.get_current_page_num == 1%}disabled{% endif %}' title='Go to the previous page'
                           href='{{ table.get_url( 'index', {"p":(table.get_current_page_num - 1)} ) }}'>
                            &lsaquo;
                        </a>
                        <span class="paging-input">
                            {{table.get_current_page_num}} of {{table.get_page_count|number_format}} pages
                        </span>
                        <a class='next-page {%if table.get_current_page_num == table.get_page_count%}disabled{% endif %}'
                           href="{{ table.get_url( 'index', {"p":(table.get_current_page_num + 1)} ) }}"
                           title='Go to the next page'>
                            &rsaquo;
                        </a>
                        <a class='last-page {%if table.get_current_page_num == table.get_page_count%}disabled{% endif %}'
                           href="{{ table.get_url( 'index', {"p":table.get_page_count} ) }}"
                           title='Go to the last page'>
                            &raquo;
                        </a>
                    </span>
                {% endif %}

            </div>

        </div>
    {% endif %}

    {% include 'data_table.twig' with { links:true } %}

{%endblock%}
